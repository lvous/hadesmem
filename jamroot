path-constant TOP
  :
    .
  ;
import boost
  ;

boost.use-project
  ;
  
use-project /asmjit
  :
    src/asmjit
  ;

use-project /beaengine
  :
    src/beaengine
  ;

use-project /memory
  :
    src/memory
  ;

use-project /tests
  :
    tests
  ;

use-project /examples
  :
    examples
  ;

project
  :
    requirements
    
    <define>BOOST_USE_WINDOWS_H
    <define>BOOST_SYSTEM_NO_DEPRECATED
    <define>BOOST_FILESYSTEM_NO_DEPRECATED
    
    <define>STRICT
    <define>UNICODE
    <define>_UNICODE
    <define>WIN32_LEAN_AND_MEAN
    
    <define>_CRT_SECURE_NO_WARNINGS
    <define>_SCL_SECURE_NO_WARNINGS
    
    <define>WINVER=_WIN32_WINNT_VISTA
    <define>_WIN32_WINNT=_WIN32_WINNT_VISTA
    
    <architecture>x86
    <threading>multi
    <runtime-link>shared
    
    <toolset>msvc:<cxxflags>"/wd4503"
    <toolset>gcc,<address-model>32:<cxxflags>"-march=i486"
	# --export-all-symbols is required because of a bug in Clang's dllexport  
	# support. Remove once this has been fixed.
	<toolset>clang:<linkflags>"-Wl,--export-all-symbols"
	<toolset>clang:<linkflags>"-Wl,--allow-multiple-definition" 
    
    <debug-symbols>on
    
    <toolset>msvc:<define>HADESMEM_MSVC
    <toolset>gcc:<define>HADESMEM_GCC
    <toolset>clang:<define>HADESMEM_CLANG
    <toolset>intel:<define>HADESMEM_INTEL
  :
    default-build debug
  :
    build-dir bin
  ;

build-project src/memory
  ;

build-project tests
  ;

build-project examples
  ;

install dist
  :
    src/memory
    examples
  :
    <toolset>msvc,<variant>debug,<address-model>32:<location>dist/msvc/debug/x86
    <toolset>msvc,<variant>debug,<address-model>64:<location>dist/msvc/debug/x64
    <toolset>msvc,<variant>release,<address-model>32:<location>dist/msvc/release/x86
    <toolset>msvc,<variant>release,<address-model>64:<location>dist/msvc/release/x64
    
    <toolset>gcc,<variant>debug,<address-model>32:<location>dist/gcc/debug/x86
    <toolset>gcc,<variant>debug,<address-model>64:<location>dist/gcc/debug/x64
    <toolset>gcc,<variant>release,<address-model>32:<location>dist/gcc/release/x86
    <toolset>gcc,<variant>release,<address-model>64:<location>dist/gcc/release/x64
    
    <toolset>clang,<variant>debug,<address-model>32:<location>dist/clang/debug/x86
    <toolset>clang,<variant>debug,<address-model>64:<location>dist/clang/debug/x64
    <toolset>clang,<variant>release,<address-model>32:<location>dist/clang/release/x86
    <toolset>clang,<variant>release,<address-model>64:<location>dist/clang/release/x64
    
    <toolset>intel,<variant>debug,<address-model>32:<location>dist/intel/debug/x86
    <toolset>intel,<variant>debug,<address-model>64:<location>dist/intel/debug/x64
    <toolset>intel,<variant>release,<address-model>32:<location>dist/intel/release/x86
    <toolset>intel,<variant>release,<address-model>64:<location>dist/intel/release/x64
    
    <install-dependencies>on
    <install-type>SHARED_LIB
    <install-type>EXE
  ;

alias hadesmem
  :
    src/memory//memory
  ;
